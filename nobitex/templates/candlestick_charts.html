<!DOCTYPE html>
{% load bootstrap4 %}
{% load render_table from django_tables2 %}
{% load ajax_table from ajax_table%}

<head>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">  </head>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
</head>
<body class="row justify-content-center">
<div class="page">
  <form method="get">
  <div>
      {% bootstrap_form form %}
  </div>
  <button class="btn btn-primary" type="submit">
      <i class="material-icons">done</i>
  </button>
  </form>
  <br>
  <p id="showData"></p>
   <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
  <script type="text/javascript">
  $('.document').ready(function(){
    var task_id = '{{task_id}}'
    setInterval(function(){
      $.ajax({
      type:"GET",
      url: "{% url 'check_status' %}",
      data : {"task_id" : task_id},
   }).done(function(response){
     if (response !== false){
      var col = [];
        for (var i = 0; i < response.length; i++) {
            for (var key in response[i]) {
                if (col.indexOf(key) === -1) {
                    col.push(key);
                }
            }
        }
        var idx1 = col.indexOf('close_time')
        if (idx1 !== -1){
          col.splice(idx1, 1)
        }
        var idx2 = col.indexOf('open_time')
        if (idx2 !== -1){
          col.splice(idx2, 1)
        }
        var table = document.createElement("table");
        var tr = table.insertRow(-1);
        for (var i = 0; i < col.length; i++) {
            var th = document.createElement("th");
            th.innerHTML = col[i];
            tr.appendChild(th);
        }
        for (var i = 0; i < response.length; i++) {
          tr = table.insertRow(-1);
          for (var j = 0; j < col.length; j++) {
              var tabCell = tr.insertCell(-1);
              tabCell.innerHTML = response[i][col[j]];
          }
        }
        var divContainer = document.getElementById("showData");
        divContainer.innerHTML = "";
        divContainer.appendChild(table);
     }
   });
    }, 2000)
});
</script>
  <!-- {% render_table table %} -->
</div>
</body>